---
title: "Cholera transmission model"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

```{r}

library(deSolve)
vacc_ode <- function( t, y, parms ) {
  r <- parms[ 1 ]
  g <- parms[ 2 ]
  
  dy1 <- -r * y[ 1 ]
  dy2 <- + r * y[ 1 ] - g * y[ 2 ]
  dy3 <- + g * y[ 2 ] 

  list(c(dy1, dy2, dy3))
}

yini <- c( y1 = 1, y2 = 0, y3 = 0 )
times <- seq( from = 0, to = 60, by = 0.01)
parms <- c( 0.02, 1/14 )
out <- ode ( times = times, y = yini, func = vacc_ode, parms = parms )
# head (out, n = 3)
class(out) <- "matrix" # without this, dplyr functions get error
library(tidyverse)
out <- tbl_df( out )
colnames( out ) <- c( "Day", "S", "VS", "VP" )
# write.csv( out, "sir_tr_05.csv", row.names = FALSE )
out <- gather( out, var, num, - Day )
out$var <- factor( out$var  )
out$model <- "Numerical"

## Analytical solutions
r <- parms[1]
g <- parms[2]
t <- times
S <- exp(-r*t)
VS <- (r*exp(t*(-g-r))*(exp(g*t)-exp(r*t)))/(g-r)
VP <- (exp(t*(-g-r))*(exp(r*t)*((g-r)*exp(g*t)+r)-g*exp(g*t)))/(g-r)

df <- data.frame( Day = t, S = S, VS = VS, VP = VP )
df <- gather( df, var, num, - Day )
df$model <- "Analytical"

d <- rbind( out, df )
d$model <- factor( d$model )
ggplot( d ) + 
    geom_line( aes( x=Day, y=num, color=var ) ) +
    labs( x="Time (day)", y="Fraction of population", color="Status" ) + 
    facet_wrap(.~model)
    theme( legend.position=c(0.85,0.45) )


```
